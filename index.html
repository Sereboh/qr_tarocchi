<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mystic Tarot</title>
<style>
  :root{
    --fg:#f4e7c2;
    --bg1:#130f22;
    --bg2:#000;
    --gold: rgba(212,175,55,0.95);
    --card-w:110px;
    --card-h:160px;
  }
  html,body{height:100%}
  body{
    margin:0;
    font-family: Georgia,serif;
    color:var(--fg);
    background: radial-gradient(circle at top,var(--bg1),var(--bg2));
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    overflow-x:hidden;
  }

  header{display:flex;justify-content:space-between;align-items:center;padding:12px 18px}
  h1{margin:0;font-size:20px;letter-spacing:2px}

  .controls{display:flex;gap:8px;align-items:center}
  button.ctrl{
    background:rgba(34,25,51,0.55);
    color:var(--fg);
    border:1px solid rgba(147,116,201,0.22);
    padding:8px 12px;border-radius:10px;
    cursor:pointer;font-size:14px;
    backdrop-filter: blur(4px);
  }

  /* deck area (transparent) */
  #deck{
    position:relative;
    width:100%;
    height:64vh;
    min-height:360px;
    display:flex;
    align-items:center;
    justify-content:center;
    perspective:1400px;
    -webkit-tap-highlight-color: transparent;
  }

  /* card basics */
  .card{
    position:absolute;
    width:var(--card-w);
    height:var(--card-h);
    border-radius:10px;
    background-size:cover;
    background-position:center;
    transform-origin:center bottom; /* rotate around bottom edge to mimic thumb pivot */
    cursor:pointer;
    opacity:0;
    transition: box-shadow .18s ease, transform .72s cubic-bezier(.2,.9,.3,1), left .72s ease, top .72s ease, opacity .28s;
    will-change: transform, left, top, opacity;
    box-shadow: 0 14px 36px rgba(0,0,0,0.6);
    border:2px solid rgba(0,0,0,0.12);
    overflow:hidden;
  }

  .card::after{
    content:"";
    position:absolute;inset:0;border-radius:10px;
    pointer-events:none;
    box-shadow: inset 0 0 0 0 rgba(212,175,55,0);
    transition: box-shadow .3s ease, filter .25s;
  }
  .card.open-style::after{
    box-shadow: inset 0 0 0 2px var(--gold);
    filter: drop-shadow(0 8px 22px rgba(0,0,0,0.6));
  }
  .card.glow{ filter: drop-shadow(0 0 14px rgba(147,116,201,0.32)); }

  .card:hover{
    transform: translateY(-10px) scale(1.06);
    z-index:3000;
    box-shadow: 0 28px 56px rgba(0,0,0,0.7);
  }

  /* stacked closed deck style breathing */
  .stack-card{ transition: transform .9s ease, opacity .5s; }
  .stack-pulse{ animation: breathe 2.6s infinite; transform-origin:center; }
  @keyframes breathe{
    0%{ transform: translateX(-50%) translateY(-50%) rotate(0deg) scale(1) }
    50%{ transform: translateX(-50%) translateY(-54%) rotate(0deg) scale(1.022) }
    100%{ transform: translateX(-50%) translateY(-50%) rotate(0deg) scale(1) }
  }

  /* shake */
  .shake{ animation: shakeit .42s cubic-bezier(.4,0,.2,1); transform-origin:center; }
  @keyframes shakeit{
    0%{ transform: translateX(-50%) rotate(0deg) }
    25%{ transform: translateX(calc(-50% + 6px)) rotate(-1.6deg) }
    50%{ transform: translateX(calc(-50% - 6px)) rotate(1.6deg) }
    75%{ transform: translateX(calc(-50% + 3px)) rotate(-0.8deg) }
    100%{ transform: translateX(-50%) rotate(0deg) }
  }

  /* overlay: gradient translucent, not a black rectangle */
  #overlay{
    position:fixed;inset:0;display:flex;align-items:center;justify-content:center;
    background: linear-gradient(180deg, rgba(0,0,0,0.55), rgba(0,0,0,0.8));
    opacity:0;pointer-events:none;transition:opacity .28s ease;
    padding:18px;
  }
  #overlay.show{ opacity:1; pointer-events:auto; }

  #box{
    width:100%;max-width:520px;background:linear-gradient(180deg,#0f0f10,#111111);
    border-radius:12px;padding:18px;box-shadow:0 20px 66px rgba(0,0,0,0.7);
    max-height:92vh;overflow:auto;transform-origin:center;transition:transform .32s cubic-bezier(.2,.9,.3,1);
  }
  #box img{width:100%;border-radius:8px;display:block}
  #title{margin-top:12px;font-size:20px}
  #desc{margin-top:10px;line-height:1.45;color:#e8dfc6;text-align:justify}
  #restart{margin-top:14px;padding:10px 14px;border-radius:10px;background:#2b1f3a;border:1px solid rgba(147,116,201,0.18);color:var(--fg);cursor:pointer}

  /* responsive tweaks */
  @media (max-width:640px){
    :root{ --card-w:88px; --card-h:128px }
    header{padding:8px}
    #box{max-width:94%}
  }
</style>
</head>
<body>
<header>
  <h1 id="titleMain">Clicca il mazzo per aprire</h1>
  <div class="controls">
    <button class="ctrl" id="musicBtn">üéµ Play</button>
    <button class="ctrl" id="langIt">IT</button>
    <button class="ctrl" id="langEn">EN</button>
  </div>
</header>

<div id="deck" aria-label="Mazzo di carte"></div>

<div id="overlay" onclick="closeCard()">
  <div id="box" onclick="event.stopPropagation()">
    <img id="imgBig" alt="">
    <div id="title"></div>
    <div id="desc"></div>
    <div style="text-align:center">
      <button id="restart">Torna al mazzo</button>
    </div>
  </div>
</div>

<audio id="bgmusic" loop preload="none"><source src="music.mp3" type="audio/mpeg"></audio>

<script>
/* ===== DATA ===== */
const namesIT = [
"Il Matto / Masaniello","Il Mago / Virgilio","La Papessa / Sibilla Cumana",
"L‚ÄôImperatrice / Maria Carolina","L‚ÄôImperatore / Federico II","Il Papa / San Gennaro",
"Gli Amanti / Sebeto e Megara","Il Carro / Maradona","La Forza / Femminiello",
"L‚ÄôEremita / Munaciello","La Ruota della Fortuna / Ruota degli Esposti",
"La Giustizia / Maddalena Cerasuolo","L‚ÄôAppeso / Maria la Rossa",
"La Morte / Anime Pezzentelle","La Temperanza / Partenope","Il Diavolo / Mammone",
"La Torre / Maschio Angioino","La Stella / Bella ‚ÄôMbriana","La Luna / Janare",
"Il Sole / Pulcinella","Il Giudizio / Vesuvio","Il Mondo / Artisti Napoletani"
];

const namesEN = [
"The Fool","The Magician","The High Priestess","The Empress","The Emperor",
"The Hierophant","The Lovers","The Chariot","Strength","The Hermit",
"Wheel of Fortune","Justice","The Hanged Man","Death","Temperance",
"The Devil","The Tower","The Star","The Moon","The Sun","Judgement","The World"
];

const descIT = [
"Il Matto / Masaniello ‚Äî La carta del Matto rappresenta la spontaneit√†, l‚Äôingenuit√† e la libert√†. √à una figura che agisce senza pregiudizi, spesso in modo impulsivo e senza calcolare i rischi. Il Matto √® fuori dagli schemi, viaggia senza meta, fiducioso nel suo istinto, ma vulnerabile ai pericoli della strada e pronto a farsi travolgere dal suo stesso caos interiore.",
"Il Mago / Virgilio ‚Äî La carta del Mago rappresenta l‚Äôabilit√†, il potere creativo e la padronanza degli strumenti necessari per trasformare la realt√†. Il Mago √® colui che sa agire con intelligenza, sfruttando le risorse a sua disposizione per raggiungere i propri obiettivi.",
"La Papessa / Sibilla Cumana ‚Äî La carta della Papessa rappresenta la saggezza occulta, l‚Äôintuizione e la conoscenza spirituale nascosta. √à una figura misteriosa e femminile, legata alla dimensione interiore. Simboleggia la comprensione profonda dei misteri della vita e la connessione con il divino, spesso celata sotto un velo di segreti o di silenzio.",
"L‚ÄôImperatrice / Maria Carolina ‚Äî La carta dell‚ÄôImperatrice rappresenta la fertilit√†, l‚Äôabbondanza e il potere creativo. √à simbolo di femminilit√†, maternit√† e crescita, legata alla natura e al ciclo vitale. L‚ÄôImperatrice √® una figura che incarna la prosperit√† e la capacit√† di governare con dolcezza, ma anche con autorit√†.",
"L‚ÄôImperatore / Federico II ‚Äî La carta dell‚ÄôImperatore rappresenta l‚Äôautorit√† e il potere terreno. √à una figura maschile forte, responsabile e razionale, in grado di portare stabilit√†.",
"Il Papa / San Gennaro ‚Äî La carta del Papa rappresenta l‚Äôautorit√† spirituale, la saggezza, la guida morale e la mediazione tra il divino e l‚Äôumano.",
"Gli Amanti / Sebeto e Megara ‚Äî La carta degli Amanti rappresenta l‚Äôamore, l‚Äôunione e la scelta. Simboleggia l‚Äôattrazione, l‚Äôarmonia e l‚Äôequilibrio tra opposti, ma anche la necessit√† di prendere decisioni che possono cambiare il corso della vita.",
"Il Carro / Maradona ‚Äî La carta del Carro rappresenta vittoria, determinazione e controllo. Simboleggia il successo ottenuto attraverso la forza di volont√†, la disciplina e la capacit√† di superare gli ostacoli.",
"La Forza / Femminiello ‚Äî La carta della Forza rappresenta il coraggio, la determinazione e la capacit√† di domare le proprie emozioni e istinti, attraverso la calma e la pazienza, piuttosto che con la violenza. Simboleggia il dominio interiore e la tenacia.",
"L‚ÄôEremita / Munaciello ‚Äî La carta dell‚ÄôEremita rappresenta la ricerca interiore, la solitudine volontaria, la saggezza acquisita attraverso l‚Äôesperienza e la riflessione. Una figura che si isola per trovare risposte e illuminare il proprio cammino.",
"La Ruota della Fortuna / Ruota degli Esposti ‚Äî La carta della Ruota della Fortuna rappresenta il ciclo della vita, il cambiamento e l‚Äôimprevedibilit√† del destino. Simboleggia i flussi e riflussi della sorte, l‚Äôalternarsi di momenti favorevoli e sfavorevoli, e la necessit√† di adattarsi al continuo movimento della vita.",
"La Giustizia / Maddalena Cerasuolo ‚Äî La carta della Giustizia rappresenta equilibrio, verit√† e imparzialit√†. Simboleggia l‚Äôazione equa, la responsabilit√† e la necessit√† di agire con correttezza e rettitudine.",
"L‚ÄôAppeso / Maria la ‚ÄúRossa‚Äù ‚Äî La carta dell‚ÄôAppeso nei tarocchi rappresenta una sospensione temporanea, una pausa forzata e un cambio di prospettiva. Simboleggia il sacrificio, l‚Äôabbandono del controllo e la riflessione interiore.",
"La Morte / Anime Pezzentelle ‚Äî La carta della Morte nei tarocchi simboleggia trasformazione, cambiamento radicale e fine di un ciclo. Sebbene spesso temuta, non rappresenta necessariamente la morte fisica, ma piuttosto la fine di una fase, il distacco dal passato e l‚Äôopportunit√† di rinascita e rinnovamento.",
"La Temperanza / Partenope ‚Äî La carta della Temperanza rappresenta l‚Äôarmonia, la moderazione, la capacit√† di fondere opposti per creare unit√†.",
"Il Diavolo / Mammone ‚Äî La carta del Diavolo rappresenta tentazione, schiavit√π, desideri materiali o comportamenti nocivi. Simboleggia l‚Äôoscurit√† interiore, la manipolazione e la perdita del controllo, ma anche la possibilit√† di liberarsi da ci√≤ che ci tiene imprigionati, poich√© invita a confrontarsi con le proprie ombre e a superare paure ed ossessioni.",
"La Torre / Maschio Angioino ‚Äî La carta della Torre rappresenta distruzione improvvisa, crisi e cambiamenti drammatici. Simboleggia l‚Äôabbattimento di strutture consolidate, sia fisiche che emotive, e la necessit√† di ricostruzione dopo un crollo.",
"La Stella / Bella ‚ÄôMbriana ‚Äî La carta della Stella rappresenta speranza, guida spirituale e rinnovamento. Un momento di serenit√† dopo il caos, un faro di luce che indica una via verso la guarigione e l‚Äôarmonia. √à una carta di ispirazione, bellezza e fiducia nel futuro.",
"La Luna / Janare ‚Äî La carta della Luna rappresenta l‚Äôinconscio, l‚Äôintuizione e i misteri nascosti. Richiama illusioni, inganni e paure, simboleggiando il lato oscuro della psiche e i cicli della natura.",
"Il Sole / Pulcinella ‚Äî La carta del Sole rappresenta gioia, vitalit√† e successo, simboleggiando chiarezza e realizzazione personale. Porta ottimismo e soddisfazione, illuminando le ombre e favorendo la crescita e il rinnovamento.",
"Il Giudizio / Vesuvio ‚Äî La carta del Giudizio rappresenta la resa dei conti e la rinascita. √à una carta che indica risveglio e riflessione, dove si fa il bilancio delle proprie scelte e azioni, e ci si prepara ad un nuovo inizio.",
"Il Mondo / Artisti Napoletani ‚Äî La carta del Mondo rappresenta il completamento, l‚Äôarmonia e il successo totale. Simboleggia la realizzazione dei propri obiettivi e la celebrazione della pienezza e dell‚Äôequilibrio raggiunti."
];

const descEN = [
"The Fool / Masaniello ‚Äî The Fool stands for spontaneity, naivety and freedom.",
"The Magician / Virgilio ‚Äî The Magician symbolizes skill, creative power and mastery of tools.",
"The High Priestess / Sibilla Cumana ‚Äî The High Priestess represents hidden wisdom and intuition.",
"The Empress / Maria Carolina ‚Äî The Empress stands for fertility, abundance and nurturing power.",
"The Emperor / Federico II ‚Äî The Emperor symbolizes authority and stable leadership.",
"The Hierophant / San Gennaro ‚Äî The Hierophant represents spiritual authority and guidance.",
"The Lovers / Sebeto e Megara ‚Äî The Lovers represent love, union and important choices.",
"The Chariot / Maradona ‚Äî The Chariot symbolizes victory, determination and control.",
"Strength / Femminiello ‚Äî Strength represents courage and inner mastery.",
"The Hermit / Munaciello ‚Äî The Hermit symbolizes introspection and wisdom.",
"Wheel of Fortune / Ruota degli Esposti ‚Äî The Wheel symbolizes life's cycles and change.",
"Justice / Maddalena Cerasuolo ‚Äî Justice represents fairness and truth.",
"The Hanged Man / Maria la Rossa ‚Äî The Hanged Man stands for suspension and new perspective.",
"Death / Anime Pezzentelle ‚Äî Death symbolizes transformation and the end of a cycle.",
"Temperance / Partenope ‚Äî Temperance represents balance and harmony.",
"The Devil / Mammone ‚Äî The Devil symbolizes temptation and inner shadows.",
"The Tower / Maschio Angioino ‚Äî The Tower stands for sudden change and rebuilding.",
"The Star / Bella ‚ÄôMbriana ‚Äî The Star represents hope and inspiration.",
"The Moon / Janare ‚Äî The Moon stands for intuition and hidden mysteries.",
"The Sun / Pulcinella ‚Äî The Sun symbolizes joy, vitality and success.",
"Judgement / Vesuvio ‚Äî Judgement symbolizes rebirth and reckoning.",
"The World / Artisti Napoletani ‚Äî The World stands for completion and fulfillment."
];

/* ===== Elements & state ===== */
const deck = document.getElementById('deck');
const overlay = document.getElementById('overlay');
const imgBig = document.getElementById('imgBig');
const titleEl = document.getElementById('title');
const descEl = document.getElementById('desc');
const titleMain = document.getElementById('titleMain');
const musicBtn = document.getElementById('musicBtn');
const langIt = document.getElementById('langIt');
const langEn = document.getElementById('langEn');
const restartBtn = document.getElementById('restart');
const bg = document.getElementById('bgmusic');

let cards = [];
let lang = 'it';
let opened = false;

/* slug helper to build filenames like "0_ilmatto.jpg" */
function slugFromName(name){
  let base = name.split('/')[0].trim().toLowerCase();
  base = base.normalize('NFD').replace(/[\u0300-\u036f]/g,'');
  base = base.replace(/[^a-z0-9]+/g,'');
  return base;
}

/* CREATE CLOSED STACK (visual composed of few stacked cards for depth) */
function createClosedDeck(){
  deck.innerHTML = '';
  cards = [];
  opened = false;
  titleMain.innerText = (lang==='it') ? 'Clicca il mazzo per aprire' : 'Tap the deck to open';

  // create layered mini-stack (6 layers)
  for(let i=0;i<6;i++){
    const el = document.createElement('div');
    el.className = 'card stack-card stack-pulse';
    el.style.left = '50%';
    el.style.top = '50%';
    el.style.transform = `translateX(-50%) translateY(-50%) rotate(${(i-3)*1.2}deg)`;
    el.style.backgroundImage = `url("back.jpg")`;
    el.style.opacity = 1 - i*0.06;
    el.style.zIndex = 200 + i;
    // topmost responds to click
    if(i===5){
      el.style.cursor='pointer';
      el.addEventListener('click', e => { e.stopPropagation(); openDeck(); });
    } else {
      el.style.pointerEvents='none';
    }
    deck.appendChild(el);
    cards.push(el);
  }
}

/* OPEN DECK: shake then spawn and fan */
function openDeck(){
  if(opened) return;
  opened = true;

  // shake top area to mimic hand adjustment
  const shaker = document.createElement('div');
  shaker.style.position='absolute';
  shaker.style.left='50%'; shaker.style.top='50%';
  shaker.style.width='0'; shaker.style.height='0';
  shaker.className='shake';
  deck.appendChild(shaker);

  setTimeout(()=> {
    deck.removeChild(shaker);
    spawnFullDeck();
  },420);
}

/* spawn 22 cards stacked center then animate fan */
function spawnFullDeck(){
  deck.innerHTML='';
  cards = [];
  const n = 22;
  for(let i=0;i<n;i++){
    const c = document.createElement('div');
    c.className='card';
    c.dataset.index = i;
    c.style.left='50%'; c.style.top='50%';
    c.style.transform = `translateX(-50%) translateY(-50%) rotate(${(Math.random()-0.5)*6}deg)`;
    c.style.backgroundImage = `url("back.jpg")`;
    c.style.opacity = 0;
    c.style.zIndex = 1000 + i;
    c.addEventListener('click', e => { e.stopPropagation(); onCardClick(c); });
    deck.appendChild(c);
    cards.push(c);
  }
  // slight delay then fan
  setTimeout(()=> fanOpenRealistic(), 80);
}

/* FAN algorithm that mimics hand-held fan like the attached photo */
function fanOpenRealistic(){
  const n = cards.length;
  const deckRect = deck.getBoundingClientRect();

  // Pivot: like thumb grip, slightly left of center and low (so cards arc downward)
  const pivotX = deckRect.width * 0.40;
  const pivotY = deckRect.height * 0.85;

  // Visible angular range tailored to photo: left-heavy natural tilt (for right-hand hold)
  const leftAngleDeg = -48;   // leftmost card angle
  const rightAngleDeg = 18;   // rightmost card angle
  const totalAngle = rightAngleDeg - leftAngleDeg; // degrees
  const mid = (n - 1) / 2;

  // radius controls how "tight" the fan hugs the hand
  const radius = Math.max(deckRect.width * 0.42, 260);

  // spacing coefficients to mimic center-tight, edges-looser
  for(let i=0;i<n;i++){
    const t = i / (n - 1); // 0..1 across deck left->right
    // ease t toward center for natural density (use easeInOut function)
    const eased = easeInOutCubic(t);
    const angleDeg = leftAngleDeg + eased * totalAngle;
    const angle = angleDeg * Math.PI / 180;

    // compute point on circle around pivot
    // we rotate a point located at (0, -radius) by angle and then offset by pivot
    const pointX = pivotX + radius * Math.sin(angle);
    const pointY = pivotY - radius * Math.cos(angle);

    // adjust small vertical offset so bases align smoothly (lower in center)
    // use a slight curve: center cards sit slightly lower
    const centerOffset = Math.cos((t - 0.5) * Math.PI) * 6; // -6..6
    const finalX = pointX - (getCardWidth()/2);
    const finalY = pointY - (getCardHeight()*0.92) + centerOffset;

    // progressive scale: center cards a bit bigger
    const scale = 1 + 0.18 * Math.cos((t - 0.5) * Math.PI);

    // stagger timing: center cards move first for natural motion
    const distFromCenter = Math.abs(i - mid);
    const delay = distFromCenter * 40 + (Math.random()*30);

    // set animation with timeout
    setTimeout(()=> {
      const c = cards[i];
      c.style.left = finalX + 'px';
      c.style.top  = finalY + 'px';
      c.style.opacity = 1;
      c.style.transform = `rotate(${angleDeg}deg) scale(${scale})`;
      c.classList.add('open-style');
      // center cards glow a bit
      if(distFromCenter < 3) c.classList.add('glow');
      c.style.zIndex = 2000 - Math.round(distFromCenter); // central on top
    }, delay);
  }
}

/* easing for smoother density (ease in-out cubic) */
function easeInOutCubic(x){ return x<0.5 ? 4*x*x*x : 1 - Math.pow(-2*x+2,3)/2; }

function getCardWidth(){ return parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--card-w')) || 110; }
function getCardHeight(){ return parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--card-h')) || 160; }

/* on card click: fade others and flip selected then overlay */
function onCardClick(card){
  if(!opened) return;
  const idx = parseInt(card.dataset.index,10);

  // animate others out
  cards.forEach(c=>{
    if(c !== card){
      c.style.transition = 'transform .35s ease, opacity .35s';
      c.style.opacity = 0;
      // shrink a bit
      c.style.transform += ' scale(0.6)';
    } else {
      // flip-like effect: quick rotateY and swap image
      c.style.transition = 'transform .48s cubic-bezier(.2,.9,.3,1)';
      // rotate a bit outward then swap background
      c.style.transform += ' rotateY(180deg) scale(1.02)';
      setTimeout(()=>{
        const slug = slugFromName(namesIT[idx]);
        c.style.backgroundImage = `url("img/${idx}_${slug}.jpg")`;
      },240);
    }
  });

  // after flip, show overlay
  setTimeout(()=> openOverlay(idx), 520);
}

/* overlay open */
function openOverlay(i){
  overlay.classList.add('show');
  titleEl.innerText = (lang==='it') ? namesIT[i] : namesEN[i];
  descEl.innerText  = (lang==='it') ? descIT[i] : descEN[i];
  const slug = slugFromName(namesIT[i]);
  imgBig.src = `img/${i}_${slug}.jpg`;
  imgBig.alt = (lang==='it') ? namesIT[i] : namesEN[i];
}

/* overlay close */
function closeCard(){
  overlay.classList.remove('show');
}

/* restart: close overlay and recreate closed deck */
function restart(){
  closeCard();
  setTimeout(()=> createClosedDeck(), 300);
}

/* music control */
musicBtn.addEventListener('click', ()=>{
  if(bg.paused){
    bg.play().catch(()=>{/* blocked by browser */});
    musicBtn.innerText = '‚è∏ Pause';
  } else {
    bg.pause();
    musicBtn.innerText = 'üéµ Play';
  }
});

/* language toggles */
langIt.addEventListener('click', ()=> setLang('it'));
langEn.addEventListener('click', ()=> setLang('en'));
function setLang(l){
  lang = l;
  titleMain.innerText = (lang==='it') ? 'Clicca il mazzo per aprire' : 'Tap the deck to open';
  // if overlay visible, update content
  if(overlay.classList.contains('show')){
    const src = imgBig.src || '';
    const m = src.match(/\/(\d+)_/);
    if(m){ const i = parseInt(m[1],10); titleEl.innerText = (lang==='it') ? namesIT[i] : namesEN[i]; descEl.innerText = (lang==='it') ? descIT[i] : descEN[i]; }
  }
}

/* helper slug reused */
function slugFromName(name){
  let base = name.split('/')[0].trim().toLowerCase();
  base = base.normalize('NFD').replace(/[\u0300-\u036f]/g,'');
  base = base.replace(/[^a-z0-9]+/g,'');
  return base;
}

/* initialize */
createClosedDeck();

/* restart button */
restartBtn.addEventListener('click', (e)=>{ e.stopPropagation(); restart(); });
overlay.addEventListener('click', (e)=>{ if(e.target===overlay) closeCard(); });

/* responsive reposition when window resized */
window.addEventListener('resize', ()=>{
  if(opened && cards.length){
    // recompute positions smoothly (no re-creation)
    fanOpenRealistic();
  } else {
    // keep closed deck aesthetics
    // do nothing special; closed stack remains centered
  }
});
</script>
</body>
</html>
