<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mystic Tarot</title>
<style>
:root{
  --fg:#f4e7c2;
  --bg1:#130f22;
  --bg2:#000;
  --card-w:110px;
  --card-h:160px;
}
html,body{
  height:100%;
  margin:0;
  font-family:Georgia,serif;
  color:var(--fg);
  background:radial-gradient(circle at top,var(--bg1),var(--bg2));
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  overflow-x:hidden;
}
header{
  display:flex;
  flex-direction:column;
  align-items:center;
  padding:12px 18px;
}
header .top-row{
  display:flex;
  justify-content:center;
  gap:8px;
  margin-top:8px;
}
h1{
  margin:0;
  font-size:20px;
  letter-spacing:2px;
  text-align:center;
}
button.ctrl{
  background:rgba(34,25,51,0.55);
  color:var(--fg);
  border:1px solid rgba(147,116,201,0.22);
  padding:8px 12px;
  border-radius:10px;
  cursor:pointer;
  font-size:14px;
  backdrop-filter: blur(4px);
}
#deck{
  position:relative;
  width:100%;
  height:calc(100vh - 120px);
  display:flex;
  align-items:center;
  justify-content:center;
  perspective:1400px;
}
.card{
  position:absolute;
  width:var(--card-w);
  height:var(--card-h);
  border-radius:10px;
  background-size:cover;
  background-position:center;
  transform-origin:center bottom;
  cursor:pointer;
  opacity:0;
  transition: transform .72s cubic-bezier(.2,.9,.3,1), left .72s ease, top .72s ease, opacity .28s;
  box-shadow:0 14px 36px rgba(0,0,0,0.6);
  border:2px solid rgba(0,0,0,0.12);
  overflow:hidden;
}
.card.glow{ filter: drop-shadow(0 0 14px rgba(147,116,201,0.32)); }
.card:hover{
  transform: translateY(-10px) scale(1.06);
  z-index:3000;
  box-shadow:0 28px 56px rgba(0,0,0,0.7);
}
.stack-card{ transition: transform .9s ease, opacity .5s; }
.stack-pulse{ animation:breathe 2.6s infinite; transform-origin:center; }
@keyframes breathe{
  0%{ transform: translateX(-50%) translateY(-50%) rotate(0deg) scale(1) }
  50%{ transform: translateX(-50%) translateY(-54%) rotate(0deg) scale(1.022) }
  100%{ transform: translateX(-50%) translateY(-50%) rotate(0deg) scale(1) }
}
.shake{ animation: shakeit .42s cubic-bezier(.4,0,.2,1); transform-origin:center; }
@keyframes shakeit{
  0%{ transform: translateX(-50%) rotate(0deg) }
  25%{ transform: translateX(calc(-50% + 6px)) rotate(-1.6deg) }
  50%{ transform: translateX(calc(-50% - 6px)) rotate(1.6deg) }
  75%{ transform: translateX(calc(-50% + 3px)) rotate(-0.8deg) }
  100%{ transform: translateX(-50%) rotate(0deg) }
}
#overlay{
  position:fixed;inset:0;display:flex;align-items:center;justify-content:center;
  background: linear-gradient(180deg, rgba(0,0,0,0.55), rgba(0,0,0,0.8));
  opacity:0;pointer-events:none;transition:opacity .28s ease;
  padding:18px;
}
#overlay.show{ opacity:1; pointer-events:auto; }
#box{
  width:100%;max-width:520px;background:linear-gradient(180deg,#0f0f10,#111111);
  border-radius:12px;padding:18px;box-shadow:0 20px 66px rgba(0,0,0,0.7);
  max-height:92vh;overflow:auto;transform-origin:center;transition:transform .32s cubic-bezier(.2,.9,.3,1);
}
#box img{width:100%;border-radius:8px;display:block}
#title{margin-top:12px;font-size:20px;text-align:center}
#desc{margin-top:10px;line-height:1.45;color:#e8dfc6;text-align:justify}
#restart{margin-top:14px;padding:10px 14px;border-radius:10px;background:#2b1f3a;border:1px solid rgba(147,116,201,0.18);color:var(--fg);cursor:pointer}

@media(max-width:640px){
  :root{ --card-w:88px; --card-h:128px }
  header{padding:8px;}
  header h1{font-size:18px;margin-bottom:6px;}
  #box{max-width:94%}
  #deck{height:calc(100vh - 140px);}
}
</style>
</head>
<body>
<header>
<h1 id="titleMain">Clicca il mazzo per aprire</h1>
<div class="top-row controls">
<button class="ctrl" id="musicBtn">ðŸŽµ Play</button>
<button class="ctrl" id="langIt">IT</button>
<button class="ctrl" id="langEn">EN</button>
</div>
</header>

<div id="deck" aria-label="Mazzo di carte"></div>

<div id="overlay" onclick="closeCard()">
<div id="box" onclick="event.stopPropagation()">
<img id="imgBig" alt="">
<div id="title"></div>
<div id="desc"></div>
<div style="text-align:center">
<button id="restart">Torna al mazzo</button>
</div>
</div>
</div>

<audio id="bgmusic" loop preload="none"><source src="music.mp3" type="audio/mpeg"></audio>

<script>
// NOMI CARTE
const namesIT=[
"Il Matto / Masaniello","Il Mago / Virgilio","La Papessa / Sibilla Cumana",
"Lâ€™Imperatrice / Maria Carolina","Lâ€™Imperatore / Federico II","Il Papa / San Gennaro",
"Gli Amanti / Sebeto e Megara","Il Carro / Maradona","La Forza / Femminiello",
"Lâ€™Eremita / Munaciello","La Ruota della Fortuna / Ruota degli Esposti",
"La Giustizia / Maddalena Cerasuolo","Lâ€™Appeso / Maria la Rossa",
"La Morte / Anime Pezzentelle","La Temperanza / Partenope","Il Diavolo / Mammone",
"La Torre / Maschio Angioino","La Stella / Bella â€™Mbriana","La Luna / Janare",
"Il Sole / Pulcinella","Il Giudizio / Vesuvio","Il Mondo / Artisti Napoletani"
];

const namesEN=[
"The Fool","The Magician","The High Priestess","The Empress","The Emperor",
"The Hierophant","The Lovers","The Chariot","Strength","The Hermit",
"Wheel of Fortune","Justice","The Hanged Man","Death","Temperance",
"The Devil","The Tower","The Star","The Moon","The Sun","Judgement","The World"
];

// DESCRIZIONI COMPLETE
const descIT=[
"Il Matto: SpontaneitÃ , ingenuitÃ  e libertÃ . Viaggia senza meta, fiducioso nellâ€™istinto, ma vulnerabile ai pericoli.",
"Il Mago: AbilitÃ , potere creativo e padronanza degli strumenti per trasformare la realtÃ .",
"La Papessa: Saggezza occulta, intuizione e conoscenza spirituale nascosta.",
"Lâ€™Imperatrice: FertilitÃ , abbondanza e potere creativo; simbolo di femminilitÃ  e maternitÃ .",
"Lâ€™Imperatore: AutoritÃ  e potere terreno; stabilitÃ  e razionalitÃ .",
"Il Papa: Guida morale, saggezza e mediazione tra divino e umano.",
"Gli Amanti: Amore, unione e scelta; armonia tra opposti e decisioni importanti.",
"Il Carro: Vittoria, determinazione e controllo; superamento ostacoli con volontÃ .",
"La Forza: Coraggio, dominio interiore e capacitÃ  di controllare emozioni e istinti.",
"Lâ€™Eremita: Ricerca interiore, saggezza, solitudine volontaria e riflessione.",
"La Ruota della Fortuna: Cicli della vita, cambiamento e necessitÃ  di adattarsi.",
"La Giustizia: Equilibrio, veritÃ , imparzialitÃ  e azione corretta.",
"Lâ€™Appeso: Sospensione temporanea, pausa forzata e nuova prospettiva.",
"La Morte: Trasformazione e fine di un ciclo; possibilitÃ  di rinascita.",
"La Temperanza: Armonia, moderazione e unione di opposti per creare unitÃ .",
"Il Diavolo: Tentazione, desideri materiali e confronto con le proprie ombre.",
"La Torre: Distruzione improvvisa, crisi e necessitÃ  di ricostruzione.",
"La Stella: Speranza, guida spirituale e rinnovamento.",
"La Luna: Inconscio, intuizione e misteri nascosti; illusioni e paure.",
"Il Sole: Gioia, vitalitÃ  e successo; chiarezza e realizzazione personale.",
"Il Giudizio: Resa dei conti, rinascita e riflessione sulle proprie scelte.",
"Il Mondo: Completamento, armonia e celebrazione dei propri obiettivi."
];

const descEN=[
"The Fool: Spontaneity, naivety, and freedom. Travels without direction, trusting instinct but vulnerable to dangers.",
"The Magician: Skill, creative power, mastery of tools to transform reality.",
"The High Priestess: Hidden wisdom, intuition, and spiritual knowledge.",
"The Empress: Fertility, abundance, and creative power; symbol of femininity and motherhood.",
"The Emperor: Authority, earthly power; stability and rationality.",
"The Hierophant: Moral guidance, wisdom, mediation between divine and human.",
"The Lovers: Love, union, and choice; harmony between opposites and important decisions.",
"The Chariot: Victory, determination, and control; overcoming obstacles with willpower.",
"Strength: Courage, inner mastery, control of emotions and instincts.",
"The Hermit: Inner search, wisdom, voluntary solitude, and reflection.",
"Wheel of Fortune: Life cycles, change, and need to adapt.",
"Justice: Balance, truth, impartiality, and correct action.",
"The Hanged Man: Temporary suspension, forced pause, and new perspective.",
"Death: Transformation and end of a cycle; opportunity for rebirth.",
"Temperance: Harmony, moderation, and uniting opposites.",
"The Devil: Temptation, material desires, and facing inner shadows.",
"The Tower: Sudden destruction, crisis, and need to rebuild.",
"The Star: Hope, spiritual guidance, and renewal.",
"The Moon: Unconscious, intuition, hidden mysteries; illusions and fears.",
"The Sun: Joy, vitality, success; clarity and personal fulfillment.",
"Judgement: Reckoning, rebirth, and reflection on choices.",
"The World: Completion, harmony, and celebration of achievements."
];

// ELEMENTI
const deckEl=document.getElementById('deck');
const overlay=document.getElementById('overlay');
const imgBig=document.getElementById('imgBig');
const titleEl=document.getElementById('title');
const descEl=document.getElementById('desc');
const titleMain=document.getElementById('titleMain');
const musicBtn=document.getElementById('musicBtn');
const langIt=document.getElementById('langIt');
const langEn=document.getElementById('langEn');
const restartBtn=document.getElementById('restart');
const bg=document.getElementById('bgmusic');

let cards=[],lang='it',opened=false;

function slugFromName(name){
let base=name.split('/')[0].trim().toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/[^a-z0-9]+/g,'');
return base;
}
function getCardW(){return parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--card-w'))||110;}
function getCardH(){return parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--card-h'))||160;}

// CREA MAZZO CHIUSO
function createClosedDeck(){
deckEl.innerHTML=''; cards=[]; opened=false;
titleMain.innerText=(lang==='it')?'Clicca il mazzo per aprire':'Tap the deck to open';
const c=document.createElement('div');
c.className='card stack-card stack-pulse';
c.style.left=`calc(50% - ${getCardW()/2}px)`;
c.style.top=`calc(50% - ${getCardH()/2}px + 30px)`;
c.style.backgroundImage='url("back.jpg")';
c.style.opacity=1;
c.addEventListener('click',()=>openDeck());
deckEl.appendChild(c);
cards.push(c);
}

// APERTURA
function openDeck(){
if(opened)return;
opened=true;
spawnDeck();
}

// CREA FAN
function spawnDeck(){
deckEl.innerHTML=''; cards=[];
const n=22,cw=getCardW(),ch=getCardH();
for(let i=0;i<n;i++){
const c=document.createElement('div'); c.className='card'; c.dataset.index=i;
c.style.left=`calc(50% - ${cw/2}px)`; c.style.top=`calc(50% - ${ch/2}px + 30px)`;
c.style.backgroundImage='url("back.jpg")'; c.style.opacity=1;
c.addEventListener('click',()=>onCardClick(c));
deckEl.appendChild(c); cards.push(c);
}
setTimeout(fanOpen,100);
}

// FAN
function fanOpen(){
const n=cards.length,deckRect=deckEl.getBoundingClientRect(),cw=getCardW(),ch=getCardH();
function fanOpen(){
  const n = cards.length;
  const cw = getCardW(), ch = getCardH();
  const deckRect = deckEl.getBoundingClientRect();

  // ðŸ”¥ CENTRO REALE DELLA PAGINA
  const pivotX = window.innerWidth / 2;
  const pivotY = deckRect.top + deckRect.height / 2 + 30;

  const leftAngle = -50;
  const rightAngle = 20;
  const totalAngle = rightAngle - leftAngle;
  const mid = (n - 1) / 2;

  const order = Array.from({length:n},(_,i)=>i)
    .sort((a,b)=>Math.abs(a-mid)-Math.abs(b-mid));

  const radius = Math.min(window.innerWidth * 0.42, 420);

  order.forEach((i, seq)=>{
    const t = i / (n - 1);
    const eased = t < 0.5 ? 4*t*t*t : 1 - Math.pow(-2*t+2,3)/2;
    const angleDeg = leftAngle + eased * totalAngle;
    const angleRad = angleDeg * Math.PI / 180;

    const x = pivotX + radius * Math.sin(angleRad) - cw/2;
    const y = pivotY - radius * Math.cos(angleRad) - ch;

    setTimeout(()=>{
      const c = cards[i];
      c.style.left = x + 'px';
      c.style.top = y + 'px';
      c.style.transform = `rotate(${angleDeg}deg) scale(${1 + 0.15*Math.cos((t-0.5)*Math.PI)})`;
      c.style.opacity = 1;
      if (Math.abs(i-mid) < 3) c.classList.add('glow');
      c.style.zIndex = 3000 - Math.round(Math.abs(i-mid));
    }, seq * 40);
  });
}

const leftAngle=-50,rightAngle=20,totalAngle=rightAngle-leftAngle,mid=(n-1)/2;
const order=Array.from({length:n},(_,i)=>i).sort((a,b)=>Math.abs(a-mid)-Math.abs(b-mid));
const positions=new Array(n);
for(let i=0;i<n;i++){
const t=i/(n-1);
const eased=t<0.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2;
const angleDeg=leftAngle+eased*totalAngle;
const angleRad=angleDeg*Math.PI/180;
const radius=Math.max(deckRect.width*0.48,280);
const px=pivotX+radius*Math.sin(angleRad),py=pivotY-radius*Math.cos(angleRad);
const centerOffset=Math.cos((t-0.5)*Math.PI)*6;
positions[i]={x:px-cw/2,y:py-ch+centerOffset,angle:angleDeg,scale:1+0.18*Math.cos((t-0.5)*Math.PI)};
}
order.forEach((i,seq)=>{
const pos=positions[i];
setTimeout(()=>{
const c=cards[i];
c.style.left=pos.x+'px'; c.style.top=pos.y+'px';
c.style.transform=`rotate(${pos.angle}deg) scale(${pos.scale})`;
c.style.opacity=1;
if(Math.abs(i-mid)<3)c.classList.add('glow');
c.style.zIndex=3000-Math.round(Math.abs(i-mid));
},seq*40+Math.random()*30);
});
}

// CARD CLICK
function onCardClick(card){
const idx=parseInt(card.dataset.index);
cards.forEach(c=>{
if(c!==card){c.style.opacity=0;c.style.transform='scale(0.6)';}
else{c.style.transform+=' rotateY(180deg) scale(1.02)'; setTimeout(()=>{c.style.backgroundImage=`url("img/${idx}_${slugFromName(namesIT[idx])}.jpg")`;},240);}
});
setTimeout(()=>openOverlay(idx),520);
}

// OVERLAY
function openOverlay(i){
overlay.classList.add('show');
titleEl.innerText=(lang==='it')?namesIT[i]:namesEN[i];
descEl.innerText=(lang==='it')?descIT[i]:descEN[i];
imgBig.src=`img/${i}_${slugFromName(namesIT[i])}.jpg`;
imgBig.alt=(lang==='it')?namesIT[i]:namesEN[i];
}
function closeCard(){overlay.classList.remove('show');}
function restart(){closeCard();setTimeout(createClosedDeck,300);}

// CONTROLLI
musicBtn.addEventListener('click',()=>{if(bg.paused){bg.play().catch(()=>{});musicBtn.innerText='â¸ Pause';}else{bg.pause();musicBtn.innerText='ðŸŽµ Play';}});
langIt.addEventListener('click',()=>setLang('it'));
langEn.addEventListener('click',()=>setLang('en'));
function setLang(l){lang=l; titleMain.innerText=(lang==='it')?'Clicca il mazzo per aprire':'Tap the deck to open'; if(overlay.classList.contains('show')){const src=imgBig.src||''; const m=src.match(/\/(\d+)_/); if(m){const i=parseInt(m[1],10); titleEl.innerText=(lang==='it')?namesIT[i]:namesEN[i]; descEl.innerText=(lang==='it')?descIT[i]:descEN[i];}}}
restartBtn.addEventListener('click',restart);
overlay.addEventListener('click',e=>{if(e.target===overlay)closeCard();});
window.addEventListener('resize',()=>{if(opened && cards.length)fanOpen();});

// INIT
createClosedDeck();
</script>
</body>
</html>
