<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mystic Tarot</title>
<style>
  :root{
    --fg:#f4e7c2;
    --bg1:#130f22;
    --bg2:#000;
    --gold: rgba(212,175,55,0.95);
    --card-w:110px;
    --card-h:160px;
  }
  html,body{height:100%}
  body{
    margin:0;
    font-family: Georgia,serif;
    color:var(--fg);
    background: radial-gradient(circle at top,var(--bg1),var(--bg2));
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    overflow-x:hidden;
  }

  header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:14px 18px;
    gap:12px;
  }
  h1{margin:0;font-size:20px;letter-spacing:2px}

  /* controls */
  .controls{display:flex;gap:8px;align-items:center}
  button.ctrl{
    background:rgba(34,25,51,0.6);
    color:var(--fg);
    border:1px solid rgba(147,116,201,0.25);
    padding:8px 12px;border-radius:10px;
    cursor:pointer;font-size:14px;
    backdrop-filter: blur(4px);
  }
  button.ctrl:active{transform:translateY(1px)}

  /* deck container ‚Äî transparent, no rectangle */
  #deck{
    position:relative;
    width:100%;
    height:62vh;
    min-height:320px;
    display:flex;
    align-items:center;
    justify-content:center;
    perspective:1400px;
    pointer-events:auto;
    -webkit-tap-highlight-color: transparent;
  }

  /* single card */
  .card{
    position:absolute;
    width:var(--card-w);
    height:var(--card-h);
    border-radius:10px;
    background-size:cover;
    background-position:center;
    transform-origin: center bottom; /* rotate around bottom to mimic hand hold */
    cursor:pointer;
    opacity:0;
    transition: box-shadow .25s ease, transform .7s cubic-bezier(.2,.9,.3,1), left .65s ease, top .65s ease, opacity .35s;
    will-change: transform, left, top, opacity;
    box-shadow: 0 12px 30px rgba(0,0,0,0.6);
    border: 2px solid rgba(0,0,0,0.12);
    overflow:hidden;
  }

  /* front/back as background images will be set inline; add gold border & glow */
  .card::after{
    content:"";
    position:absolute;inset:0;border-radius:10px;
    pointer-events:none;
    box-shadow: inset 0 0 0 2px rgba(212,175,55,0); /* will be animated to gold on open */
    transition: box-shadow .35s ease, filter .25s;
  }

  .card.open-style::after{
    box-shadow: inset 0 0 0 2px var(--gold);
    filter: drop-shadow(0 6px 18px rgba(0,0,0,0.6));
  }

  /* hover glow */
  .card:hover{
    box-shadow: 0 20px 44px rgba(0,0,0,0.7);
    transform: translateY(-10px) rotateY(0deg) scale(1.08);
    z-index:2000;
  }
  .card.glow{
    filter: drop-shadow(0 0 12px rgba(147,116,201,0.35));
  }

  /* breathing (closed deck) */
  .stack-pulse{
    animation: breathe 2.6s infinite;
  }
  @keyframes breathe{
    0%{ transform: translateX(-50%) translateY(0) scale(1) }
    50%{ transform: translateX(-50%) translateY(-4px) scale(1.02) }
    100%{ transform: translateX(-50%) translateY(0) scale(1) }
  }

  /* shake animation */
  .shake{
    animation: shakeit .42s cubic-bezier(.4,.0,.2,1);
  }
  @keyframes shakeit{
    0%{ transform: translateX(-50%) rotate(0deg) }
    25%{ transform: translateX(calc(-50% + 6px)) rotate(-1.6deg) }
    50%{ transform: translateX(calc(-50% - 6px)) rotate(1.6deg) }
    75%{ transform: translateX(calc(-50% + 3px)) rotate(-0.8deg) }
    100%{ transform: translateX(-50%) rotate(0deg) }
  }

  /* overlay (semi transparent gradient, not solid black) */
  #overlay{
    position:fixed;inset:0;display:flex;align-items:center;justify-content:center;
    background: linear-gradient(180deg, rgba(0,0,0,0.65), rgba(0,0,0,0.85));
    opacity:0;pointer-events:none;transition:opacity .28s ease;
    padding:18px;
  }
  #overlay.show{opacity:1;pointer-events:auto}

  #box{
    width:100%;max-width:460px;background:linear-gradient(180deg,#0f0f10, #111111);
    border-radius:12px;padding:18px;box-shadow:0 18px 60px rgba(0,0,0,0.7);
    max-height:92vh;overflow:auto;
    transform-origin:center;transition: transform .32s cubic-bezier(.2,.9,.3,1);
  }
  #overlay.show #box{transform:scale(1)}

  #box img{width:100%;border-radius:8px;display:block}
  #title{margin-top:12px;font-size:20px}
  #desc{margin-top:10px;line-height:1.45;color:#e8dfc6;text-align:justify}

  #restart{margin-top:14px;padding:10px 14px;border-radius:10px;background:#2b1f3a;border:1px solid rgba(147,116,201,0.18);color:var(--fg);cursor:pointer}

  /* responsive tweaks */
  @media (max-width:640px){
    :root{--card-w:88px;--card-h:128px}
    header{padding:10px}
    #box{max-width:95%}
  }
</style>
</head>
<body>
<header>
  <h1 id="titleMain">Clicca il mazzo per aprire</h1>
  <div class="controls">
    <button class="ctrl" id="musicBtn">üéµ Play</button>
    <button class="ctrl" id="langIt">IT</button>
    <button class="ctrl" id="langEn">EN</button>
  </div>
</header>

<!-- deck (transparent background) -->
<div id="deck" aria-label="Mazzo di carte"></div>

<!-- overlay -->
<div id="overlay" onclick="closeCard()">
  <div id="box" onclick="event.stopPropagation()">
    <img id="imgBig" alt="">
    <div id="title"></div>
    <div id="desc"></div>
    <div style="text-align:center">
      <button id="restart">Torna al mazzo</button>
    </div>
  </div>
</div>

<!-- audio -->
<audio id="bgmusic" loop preload="none">
  <source src="music.mp3" type="audio/mpeg">
</audio>

<script>
/* ---------- DATA ---------- */
const namesIT = [
"Il Matto / Masaniello","Il Mago / Virgilio","La Papessa / Sibilla Cumana",
"L‚ÄôImperatrice / Maria Carolina","L‚ÄôImperatore / Federico II","Il Papa / San Gennaro",
"Gli Amanti / Sebeto e Megara","Il Carro / Maradona","La Forza / Femminiello",
"L‚ÄôEremita / Munaciello","La Ruota della Fortuna / Ruota degli Esposti",
"La Giustizia / Maddalena Cerasuolo","L‚ÄôAppeso / Maria la Rossa",
"La Morte / Anime Pezzentelle","La Temperanza / Partenope","Il Diavolo / Mammone",
"La Torre / Maschio Angioino","La Stella / Bella ‚ÄôMbriana","La Luna / Janare",
"Il Sole / Pulcinella","Il Giudizio / Vesuvio","Il Mondo / Artisti Napoletani"
];

const namesEN = [
"The Fool","The Magician","The High Priestess","The Empress","The Emperor",
"The Hierophant","The Lovers","The Chariot","Strength","The Hermit",
"Wheel of Fortune","Justice","The Hanged Man","Death","Temperance",
"The Devil","The Tower","The Star","The Moon","The Sun","Judgement","The World"
];

/* italian full descriptions (as you provided earlier; shortened for brevity placeholders replaced with full text) */
const descIT = [
"Il Matto / Masaniello ‚Äî La carta del Matto rappresenta la spontaneit√†, l‚Äôingenuit√† e la libert√†. √à una figura che agisce senza pregiudizi, spesso in modo impulsivo e senza calcolare i rischi. Il Matto √® fuori dagli schemi, viaggia senza meta, fiducioso nel suo istinto, ma vulnerabile ai pericoli della strada e pronto a farsi travolgere dal suo stesso caos interiore.",
"Il Mago / Virgilio ‚Äî La carta del Mago rappresenta l‚Äôabilit√†, il potere creativo e la padronanza degli strumenti necessari per trasformare la realt√†. Il Mago √® colui che sa agire con intelligenza, sfruttando le risorse a sua disposizione per raggiungere i propri obiettivi.",
"La Papessa / Sibilla Cumana ‚Äî La carta della Papessa rappresenta la saggezza occulta, l‚Äôintuizione e la conoscenza spirituale nascosta. √à una figura misteriosa e femminile, legata alla dimensione interiore. Simboleggia la comprensione profonda dei misteri della vita e la connessione con il divino, spesso celata sotto un velo di segreti o di silenzio.",
"L‚ÄôImperatrice / Maria Carolina ‚Äî La carta dell‚ÄôImperatrice rappresenta la fertilit√†, l‚Äôabbondanza e il potere creativo. √à simbolo di femminilit√†, maternit√† e crescita, legata alla natura e al ciclo vitale. L‚ÄôImperatrice √® una figura che incarna la prosperit√† e la capacit√† di governare con dolcezza, ma anche con autorit√†.",
"L‚ÄôImperatore / Federico II ‚Äî La carta dell‚ÄôImperatore rappresenta l‚Äôautorit√† e il potere terreno. √à una figura maschile forte, responsabile e razionale, in grado di portare stabilit√†.",
"Il Papa / San Gennaro ‚Äî La carta del Papa rappresenta l‚Äôautorit√† spirituale, la saggezza, la guida morale e la mediazione tra il divino e l‚Äôumano.",
"Gli Amanti / Sebeto e Megara ‚Äî La carta degli Amanti rappresenta l‚Äôamore, l‚Äôunione e la scelta. Simboleggia l‚Äôattrazione, l‚Äôarmonia e l‚Äôequilibrio tra opposti, ma anche la necessit√† di prendere decisioni che possono cambiare il corso della vita.",
"Il Carro / Maradona ‚Äî La carta del Carro rappresenta vittoria, determinazione e controllo. Simboleggia il successo ottenuto attraverso la forza di volont√†, la disciplina e la capacit√† di superare gli ostacoli.",
"La Forza / Femminiello ‚Äî La carta della Forza rappresenta il coraggio, la determinazione e la capacit√† di domare le proprie emozioni e istinti, attraverso la calma e la pazienza, piuttosto che con la violenza. Simboleggia il dominio interiore e la tenacia.",
"L‚ÄôEremita / Munaciello ‚Äî La carta dell‚ÄôEremita rappresenta la ricerca interiore, la solitudine volontaria, la saggezza acquisita attraverso l‚Äôesperienza e la riflessione. Una figura che si isola per trovare risposte e illuminare il proprio cammino.",
"La Ruota della Fortuna / Ruota degli Esposti ‚Äî La carta della Ruota della Fortuna rappresenta il ciclo della vita, il cambiamento e l‚Äôimprevedibilit√† del destino. Simboleggia i flussi e riflussi della sorte, l‚Äôalternarsi di momenti favorevoli e sfavorevoli, e la necessit√† di adattarsi al continuo movimento della vita.",
"La Giustizia / Maddalena Cerasuolo ‚Äî La carta della Giustizia rappresenta equilibrio, verit√† e imparzialit√†. Simboleggia l‚Äôazione equa, la responsabilit√† e la necessit√† di agire con correttezza e rettitudine.",
"L‚ÄôAppeso / Maria la ‚ÄúRossa‚Äù ‚Äî La carta dell‚ÄôAppeso nei tarocchi rappresenta una sospensione temporanea, una pausa forzata e un cambio di prospettiva. Simboleggia il sacrificio, l‚Äôabbandono del controllo e la riflessione interiore.",
"La Morte / Anime Pezzentelle ‚Äî La carta della Morte nei tarocchi simboleggia trasformazione, cambiamento radicale e fine di un ciclo. Sebbene spesso temuta, non rappresenta necessariamente la morte fisica, ma piuttosto la fine di una fase, il distacco dal passato e l‚Äôopportunit√† di rinascita e rinnovamento.",
"La Temperanza / Partenope ‚Äî La carta della Temperanza rappresenta l‚Äôarmonia, la moderazione, la capacit√† di fondere opposti per creare unit√†.",
"Il Diavolo / Mammone ‚Äî La carta del Diavolo rappresenta tentazione, schiavit√π, desideri materiali o comportamenti nocivi. Simboleggia l‚Äôoscurit√† interiore, la manipolazione e la perdita del controllo, ma anche la possibilit√† di liberarsi da ci√≤ che ci tiene imprigionati, poich√© invita a confrontarsi con le proprie ombre e a superare paure ed ossessioni.",
"La Torre / Maschio Angioino ‚Äî La carta della Torre rappresenta distruzione improvvisa, crisi e cambiamenti drammatici. Simboleggia l‚Äôabbattimento di strutture consolidate, sia fisiche che emotive, e la necessit√† di ricostruzione dopo un crollo.",
"La Stella / Bella ‚ÄôMbriana ‚Äî La carta della Stella rappresenta speranza, guida spirituale e rinnovamento. Un momento di serenit√† dopo il caos, un faro di luce che indica una via verso la guarigione e l‚Äôarmonia. √à una carta di ispirazione, bellezza e fiducia nel futuro.",
"La Luna / Janare ‚Äî La carta della Luna rappresenta l‚Äôinconscio, l‚Äôintuizione e i misteri nascosti. Richiama illusioni, inganni e paure, simboleggiando il lato oscuro della psiche e i cicli della natura.",
"Il Sole / Pulcinella ‚Äî La carta del Sole rappresenta gioia, vitalit√† e successo, simboleggiando chiarezza e realizzazione personale. Porta ottimismo e soddisfazione, illuminando le ombre e favorendo la crescita e il rinnovamento.",
"Il Giudizio / Vesuvio ‚Äî La carta del Giudizio rappresenta la resa dei conti e la rinascita. √à una carta che indica risveglio e riflessione, dove si fa il bilancio delle proprie scelte e azioni, e ci si prepara ad un nuovo inizio.",
"Il Mondo / Artisti Napoletani ‚Äî La carta del Mondo rappresenta il completamento, l‚Äôarmonia e il successo totale. Simboleggia la realizzazione dei propri obiettivi e la celebrazione della pienezza e dell‚Äôequilibrio raggiunti."
];

const descEN = [
"The Fool / Masaniello ‚Äî The Fool stands for spontaneity, naivety and freedom; he acts often impulsively and trusts his instincts while facing life‚Äôs hazards.",
"The Magician / Virgilio ‚Äî The Magician symbolizes skill, creative power and mastery of tools to transform reality, using resources wisely to reach goals.",
"The High Priestess / Sibilla Cumana ‚Äî The High Priestess represents hidden wisdom, intuition and spiritual knowledge, linked to inner life and mystery.",
"The Empress / Maria Carolina ‚Äî The Empress stands for fertility, abundance and creative power, embodying femininity and nurturing governance.",
"The Emperor / Federico II ‚Äî The Emperor symbolizes authority, responsibility and rational leadership bringing stability.",
"The Hierophant / San Gennaro ‚Äî The Hierophant stands for spiritual authority and moral guidance between divine and human.",
"The Lovers / Sebeto e Megara ‚Äî The Lovers represent love, union and decisive choices, balancing opposites and life-changing decisions.",
"The Chariot / Maradona ‚Äî The Chariot symbolizes victory, determination and control achieved through discipline and will.",
"Strength / Femminiello ‚Äî Strength represents courage, self-mastery and gentle control of instincts through patience.",
"The Hermit / Munaciello ‚Äî The Hermit stands for inner search, voluntary solitude and wisdom gained through reflection.",
"Wheel of Fortune / Ruota degli Esposti ‚Äî The Wheel symbolizes life cycles, change and the unpredictability of fate.",
"Justice / Maddalena Cerasuolo ‚Äî Justice stands for balance, truth and impartial action, responsibility and fairness.",
"The Hanged Man / Maria la Rossa ‚Äî The Hanged Man represents suspension, sacrifice and a change of perspective, inviting inner reflection.",
"Death / Anime Pezzentelle ‚Äî Death symbolizes radical transformation and the end of a cycle, opening space for renewal.",
"Temperance / Partenope ‚Äî Temperance represents harmony, moderation and the blend of opposites to create unity.",
"The Devil / Mammone ‚Äî The Devil symbolizes temptation, bondage and destructive desires, and the path to break free from them.",
"The Tower / Maschio Angioino ‚Äî The Tower stands for sudden upheaval and dismantling, followed by necessary rebuilding.",
"The Star / Bella ‚ÄôMbriana ‚Äî The Star represents hope, healing and spiritual guidance after chaos.",
"The Moon / Janare ‚Äî The Moon stands for the unconscious, intuition and hidden illusions and fears.",
"The Sun / Pulcinella ‚Äî The Sun symbolizes joy, vitality, clarity and success, bringing growth and optimism.",
"Judgement / Vesuvio ‚Äî Judgement symbolizes reckoning, rebirth and taking stock before a new beginning.",
"The World / Artisti Napoletani ‚Äî The World stands for completion, harmony and fulfillment; celebration of wholeness."
];

/* ---------- state + elements ---------- */
const deck = document.getElementById('deck');
const overlay = document.getElementById('overlay');
const box = document.getElementById('box');
const imgBig = document.getElementById('imgBig');
const titleEl = document.getElementById('title');
const descEl = document.getElementById('desc');
const titleMain = document.getElementById('titleMain');
const musicBtn = document.getElementById('musicBtn');
const langIt = document.getElementById('langIt');
const langEn = document.getElementById('langEn');
const restartBtn = document.getElementById('restart');
const bg = document.getElementById('bgmusic');

let cards = [];
let lang = 'it';
let opened = false;

/* ---------- helper: slug for filenames (expects e.g. 0_ilmatto.jpg) ---------- */
function slugFromName(itName){
  // take part before slash or before first space after article; prefer first word significant
  let base = itName.split('/')[0].trim().toLowerCase();
  // remove non letters numbers
  base = base.normalize('NFD').replace(/[\u0300-\u036f]/g,'');
  base = base.replace(/[^a-z0-9]+/g,'');
  return base;
}

/* ---------- create closed deck (single stacked card element, with breathing & hint) ---------- */
function createClosedDeck(){
  deck.innerHTML='';
  cards = [];
  opened = false;
  titleMain.innerText = (lang==='it') ? 'Clicca il mazzo per aprire' : 'Tap the deck to open';

  // create stacked layered cards to give depth
  for(let i=0;i<6;i++){
    const stack = document.createElement('div');
    stack.className='card stack-pulse';
    stack.style.left='50%';
    stack.style.top='50%';
    stack.style.transform='translateX(-50%) translateY(-50%) rotate(' + ((i-2)*1.2) + 'deg)';
    stack.style.backgroundImage = `url("back.jpg")`;
    stack.style.opacity = 1 - i*0.06;
    stack.style.zIndex = 200 + i;
    // only topmost responds to click
    if(i===5){
      stack.style.cursor='pointer';
      stack.addEventListener('click',(e)=>{ e.stopPropagation(); openDeck(); });
    } else {
      stack.style.pointerEvents='none';
    }
    deck.appendChild(stack);
    cards.push(stack);
  }
}

/* ---------- openDeck: shake then create full set and animate opening (natural hand style) ---------- */
function openDeck(){
  if(opened) return;
  opened = true;
  // remove existing stacks
  deck.innerHTML='';
  cards=[];

  // initial shake indicator anchored at center ‚Äî create a temporary element to show shake on deck
  const anchor = document.createElement('div');
  anchor.style.position='absolute';
  anchor.style.left='50%'; anchor.style.top='50%';
  anchor.style.width='0'; anchor.style.height='0';
  deck.appendChild(anchor);
  anchor.classList.add('shake');

  // after shake finishes, spawn real cards and animate
  setTimeout(()=> {
    deck.removeChild(anchor);
    spawnCardsAndAnimate();
  },420);
}

/* ---------- spawn cards, place stacked center, then animate to fan ---------- */
function spawnCardsAndAnimate(){
  const n = 22;
  // create card elements (all identical back initially) positioned at center stacked
  for(let i=0;i<n;i++){
    const c = document.createElement('div');
    c.className = 'card';
    c.dataset.index = i;
    c.style.left = '50%';
    c.style.top = '50%';
    c.style.transform = 'translateX(-50%) translateY(-50%) rotate(' + ((Math.random()-0.5)*6) + 'deg) scale(1)';
    c.style.backgroundImage = `url("back.jpg")`;
    c.style.opacity = 0;
    c.style.zIndex = 1000 + i;
    // click to reveal (flip + overlay)
    c.addEventListener('click', (e)=>{ e.stopPropagation(); onCardClick(c); });
    deck.appendChild(c);
    cards.push(c);
  }

  // small delay so elements render, then animate spread
  setTimeout(()=> fanOpenFromHand(), 80);
}

/* ---------- compute "hand" fan positions and animate with stagger and easing ---------- */
function fanOpenFromHand(){
  const n = cards.length;
  const deckRect = deck.getBoundingClientRect();
  const cx = deckRect.width * 0.52; // slight offset to right to mimic holding in right hand
  const baseY = deckRect.height * 0.58; // base line (where the thumb holds)
  const spreadTotalDeg = 42;  // total visible spread in degrees
  const mid = (n - 1) / 2;
  const stepX = Math.max(14, deckRect.width * 0.02); // horizontal spacing between cards
  const lift = Math.max(6, deckRect.height*0.02);
  const baseRotationOffset = -10; // slight left tilt for natural hand hold

  cards.forEach((c, idx)=>{
    const d = idx - mid; // negative left, positive right
    const angle = baseRotationOffset + (d * (spreadTotalDeg / mid));
    // X: center plus linear offset * d, but add a small curve using abs(d) to simulate splay
    const x = cx + d * stepX + (d<0 ? -Math.abs(d)*1.0 : Math.abs(d)*0.6);
    const y = baseY - Math.abs(d) * lift - (Math.cos((d/mid)*Math.PI/2)*6); // center slightly lower
    const scale = 1 + 0.18 * Math.cos((d/mid)*Math.PI/2); // central slightly bigger

    // animate with stagger ‚Äî center cards move first for natural feel
    const centerDist = Math.abs(d);
    const delay = centerDist * 40 + (Math.random()*40); // small noise

    setTimeout(()=>{
      // update visual: set card front image (we keep back until flip)
      const slug = slugFromName(namesIT[idx]);
      const frontPath = `img/${idx}_${slug}.jpg`;
      // set front as background-image via layered background, but keep back until flip:
      // For nicer effect, set background to front but rotateY not applied yet: we will show back image visually by overlay? Simpler: set both images as CSS background with gradient? To keep it simple, set background to front but keep a back overlay by drawing an inner element? For performance we choose to set front image, and keep user perceives back until they flip. To ensure they see back, we set background-image to back.jpg first, then later when flipped we change background to front.
      c.style.backgroundImage = `url("back.jpg")`; // ensure back visible
      c.style.opacity = 1;
      c.style.left = (x - (parseFloat(getComputedStyle(c).width) || 110)/2) + 'px';
      c.style.top  = (y - (parseFloat(getComputedStyle(c).height) || 160)/2) + 'px';
      c.style.transform = `rotate(${angle}deg) scale(${scale})`;
      c.classList.add('open-style');
      // make glow subtle on center cards
      if(Math.abs(d) < 3) c.classList.add('glow');
    }, delay);
  });
}

/* ---------- clicking a card: play flip animation then open overlay ---------- */
function onCardClick(card){
  if(!opened) return;
  // find index
  const idx = parseInt(card.dataset.index,10);

  // Animate others fading
  cards.forEach(c=>{
    if(c!==card){
      c.style.transition = 'opacity 0.45s ease, transform 0.45s ease';
      c.style.opacity = 0;
      c.style.transform += ' scale(0.6)';
    } else {
      // flip this card visually: we swap background to front image and do a quick rotateY effect by toggling 3D transform
      const slug = slugFromName(namesIT[idx]);
      const frontPath = `img/${idx}_${slug}.jpg`;
      // add a temporary CSS flip by scaling X then switching image (simulate flip)
      card.style.transition = 'transform 0.45s cubic-bezier(.2,.9,.3,1), opacity 0.3s';
      card.style.transform += ' rotateY(180deg) scale(1.05)';
      // after half flip, swap image
      setTimeout(()=>{
        card.style.backgroundImage = `url("${frontPath}")`;
      },240);
    }
  });

  // open overlay slightly after flip
  setTimeout(()=> openOverlay(idx), 460);
}

/* ---------- overlay open (responsive, shows full text) ---------- */
function openOverlay(i){
  overlay.classList.add('show');
  titleEl.innerText = (lang==='it') ? namesIT[i] : namesEN[i];
  descEl.innerText  = (lang==='it') ? descIT[i] : descEN[i];
  const slug = slugFromName(namesIT[i]);
  imgBig.src = `img/${i}_${slug}.jpg`;
  imgBig.alt = (lang==='it') ? namesIT[i] : namesEN[i];
}

/* ---------- overlay close ---------- */
function closeCard(){
  overlay.classList.remove('show');
}

/* ---------- restart: close overlay, re-create closed deck ---------- */
function restart(){
  closeCard();
  // re-init after overlay hidden (allow smoothness)
  setTimeout(()=> createClosedDeck(), 260);
}

/* ---------- music control ---------- */
musicBtn.addEventListener('click', ()=>{
  if(bg.paused){
    bg.play().catch(()=>{/* autoplay blocked */});
    musicBtn.innerText = '‚è∏ Pause';
  } else {
    bg.pause();
    musicBtn.innerText = 'üéµ Play';
  }
});

/* ---------- language toggles ---------- */
langIt.addEventListener('click', ()=>{ setLang('it'); });
langEn.addEventListener('click', ()=>{ setLang('en'); });

function setLang(l){
  lang = l;
  titleMain.innerText = (lang==='it') ? 'Clicca il mazzo per aprire' : 'Tap the deck to open';
  // if overlay visible, update text
  if(overlay.classList.contains('show')){
    // try preserve current card index from img src
    const src = imgBig.src || '';
    const m = src.match(/\/(\d+)_/);
    if(m){
      const i = parseInt(m[1],10);
      titleEl.innerText = (lang==='it') ? namesIT[i] : namesEN[i];
      descEl.innerText  = (lang==='it') ? descIT[i] : descEN[i];
    }
  }
}

/* ---------- utilities ---------- */
function slugFromName(name){
  // reuse function defined earlier in case of scoping
  let base = name.split('/')[0].trim().toLowerCase();
  base = base.normalize('NFD').replace(/[\u0300-\u036f]/g,'');
  base = base.replace(/[^a-z0-9]+/g,'');
  return base;
}

/* ---------- initial run ---------- */
createClosedDeck();

/* ---------- keyboard / accessibility: restart button & overlay buttons ---------- */
restartBtn.addEventListener('click', (e)=>{ e.stopPropagation(); restart(); });
overlay.addEventListener('click', (e)=>{ if(e.target===overlay) closeCard(); });

/* ---------- adjust layout on resize: if opened, recompute positions slightly ---------- */
window.addEventListener('resize', ()=>{
  if(opened && cards.length>0){
    // recompute new positions and apply without re-creating
    // approximate reposition similar to fanOpenFromHand but non-blocking
    const deckRect = deck.getBoundingClientRect();
    const cx = deckRect.width * 0.52;
    const baseY = deckRect.height * 0.58;
    const n = cards.length;
    const mid = (n-1)/2;
    const spreadTotalDeg = 42;
    const stepX = Math.max(14, deckRect.width * 0.02);
    const lift = Math.max(6, deckRect.height*0.02);
    cards.forEach((c, idx)=>{
      const d = idx - mid;
      const angle = -10 + (d * (spreadTotalDeg / mid));
      const x = cx + d * stepX + (d<0 ? -Math.abs(d)*1.0 : Math.abs(d)*0.6);
      const y = baseY - Math.abs(d) * lift - (Math.cos((d/mid)*Math.PI/2)*6);
      const scale = 1 + 0.18 * Math.cos((d/mid)*Math.PI/2);
      c.style.left = (x - parseFloat(getComputedStyle(c).width)/2) + 'px';
      c.style.top  = (y - parseFloat(getComputedStyle(c).height)/2) + 'px';
      c.style.transform = `rotate(${angle}deg) scale(${scale})`;
    });
  }
});
</script>
</body>
</html>
